<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="C:\Users\Win7 Pro x64\Desktop\webtechserver\webtechserver\public\stylesheets\style1.css">
        <title></title>
        <title>Karten</title>
    </head>

    <body>
        <div class="flex-container">
            <h1 class="flex-item"><a href="https://travelmap1312.herokuapp.com/karte">Travelmap</a></h1>
            <header class="column">
                <a class="flex-item" id="hlogin" href="https://travelmap1312.herokuapp.com/">Login</a>
                <a class="flex-item" id="hueber" href="https://travelmap1312.herokuapp.com/uebersicht">Reiseuebersicht</a>
                <a class="flex-item" id="hkarte" href="https://travelmap1312.herokuapp.com/karte">Karte</a>
                <a class="flex-item" id="hkarte" href="https://travelmap1312.herokuapp.com/gruppen">Gruppenreisen</a>
                <button onclick="logout()" class="flex-item" type="submit" id="blogout">Logout</button>
            </header>

            <div class="column">
                <h2>Gruppenreisen</h2>
                <button onclick="showGroupForm()">Neue Gruppe erstellen</button>
                <button onclick="showGroups()">Meine Gruppen</button>
                <div id="vform">
                    
                </div>

            </div>


        </div>

     <script>

        function showGroupForm(){
            document.getElementById('vform').innerHTML = '<form class="column" id="createGroup"><label for="text">Name der Gruppe:</label><input type="text" id="gname" name="gname"><input type="button" onclick="createGroup()" value="Erstellen" /></form>';
        }

        const requestGroups = async () => {

            return await fetch("https://travelmap1312.herokuapp.com/getGroups", {
                method: "GET",
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
            .then(result => result.json())
            .then(json => json)
        }

        async function showGroups(){
            document.getElementById('vform').innerHTML = '';
            
            var groups = await requestGroups();
            //Table
            var gtable = document.createElement("TABLE");
            gtable.setAttribute('id', 'myTable');
            document.getElementById('vform').appendChild(gtable);
            
            //Table Head
            var gthead = document.createElement("TH");
            gthead.innerText = 'Gruppen';
            document.getElementById('myTable').appendChild(gthead);

            //Table Rows
            var tr;
            var tc;
            var but;

            for(var i = 0; i < groups.length; i++){
                tr = document.createElement("TR");
                tc = document.createElement("TD");
                tc.innerText = groups[i].group_name;
                tr.appendChild(tc);

                tc = document.createElement("TD");
                but = document.createElement("BUTTON");
                but.innerText = 'Gruppen Reisen ansehen';
                but.setAttribute('onclick', 'showTravels()');
                tc.appendChild(but);
                tr.appendChild(tc);

                tc = document.createElement("TD");
                but = document.createElement("BUTTON");
                but.innerText = 'Mitglied hinzufügen';
                but.setAttribute('onclick', 'addMember("'+ groups[i].group_id +'")');
                tc.appendChild(but);
                tr.appendChild(tc);

                document.getElementById('myTable').appendChild(tr);
            }

        }

         const requestNewGroup = async (gname, email) => {

            return await fetch("https://travelmap1312.herokuapp.com/newGroup", {
                method: "POST",
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    gname: gname,
                    email: email
                })
            })
            .then(result => result.json())
            .then(json => json)
        }

        async function createGroup(){
             var gname = document.getElementById('gname').value;
             var state = await requestNewGroup(gname, 'flo.bauer98@web.de');
             alert(state.created);
        }


        const requestAddMember = async (email, gid) =>{
            return await fetch("https://travelmap1312.herokuapp.com/addUserToGroup", {
                method: "POST",
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: gid,
                    email: email
                })
            })
            .then(result => result.json())
            .then(json => json)
        }

        //TODO
        async function addMember(gid){
            var email = prompt("Bitte gib die E-Mail der Person ein, die du zu deiner Gruppe hinzufügen willst.", "example@test.de");
            alert(email + gid);
            console.log(await requestAddMember(email,gid));
        }

        

     </script>  

    </body>

</html>